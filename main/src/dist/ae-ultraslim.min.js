!function(e){"use strict";e=window.æ||new e,window.æ=window.ultraslim=e}(function(){this.templates={},this.services=[];var attrPrefix="ae-",expPrefix="{{",expSuffix="}}",views={},me=this,View=(this.templates.load=function(e){var t=this,n=new XMLHttpRequest,o="string"==typeof e?e:e.url,r="object"==typeof e?e:void 0;this.cache[o]?(e=this.cache[o],t.onDone&&t.onDone instanceof Function&&t.onDone(e,r)):(n.addEventListener("load",function(){var e=n.responseText;n.status<300?(t.onLoad&&t.onLoad instanceof Function&&(e=t.onLoad(e)||e),t.cache[o]=e,t.onDone&&t.onDone instanceof Function&&t.onDone(e,r)):t.onError&&t.onError instanceof Function&&t.onError(r)}),n.addEventListener("error",function(){t.onError&&t.onError instanceof Function&&t.onError(r)}),n.open("GET",o),n.send())},this.templates.onLoad=void 0,this.templates.onError=void 0,this.templates.onDone=function(e){return e},this.templates.cache={},this.service=function(r,i,e){if(void 0===r||"object"!=typeof r)throw new Error("o is not an object.");if(void 0===e||"object"!=typeof e)throw new Error("No configuration object.");if(void 0!==e.onError&&"function"!=typeof e.onError)throw new Error("onError-handler is not a function.");if(void 0!==e.onBeforeSend&&"function"!=typeof e.onBeforeSend)throw new Error("onBeforeSend-handler is not a function.");if(void 0!==e.onDone&&"function"!=typeof e.onDone)throw new Error("onDone-handler is not a function.");r.hasOwnProperty(i)||(r[i]=[],this.object(r));var a={};function s(e,t){e&&e.onBeforeSend&&e.onBeforeSend instanceof Function?e.onBeforeSend(t):a.onBeforeSend&&a.onBeforeSend(t)}function d(e,t){var n,o;t.status<400?(o=t,(n=e)&&n.onSuccess&&n.onSuccess instanceof Function?n.onSuccess(o.status,o):a.onSuccess&&a.onSuccess(o.status,o)):(n=t,(o=e)&&o.onError&&o.onError instanceof Function?o.onError(n.status,n):a.onError&&a.onError(n.status,n)),o=t,(n=e)&&n.onDone&&n.onDone instanceof Function?n.onDone(o.status,o):a.onDone&&a.onDone(o)}return(a={}).url="string"==typeof e?e:e.url,a.dataProp=void 0!==e.dataProp?e.dataProp:void 0,a.onError="function"==typeof e.onError?e.onError:void 0,a.onBeforeSend="function"==typeof e.onBeforeSend?e.onBeforeSend:void 0,a.onSuccess="function"==typeof e.onSuccess?e.onSuccess:void 0,a.onDone="function"==typeof e.onDone?e.onDone:void 0,æ.services.push(a),a.load=function(n){var o=new XMLHttpRequest;o.addEventListener("load",function(e){var t;o.status<400&&(t=JSON.parse(o.responseText),r[i]=void 0!==a.dataProp?t[a.dataProp]:t),d(n,o)}),o.open("GET",this.url),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),s(n,o),o.send()},a.delete=function(e,t){var n=new XMLHttpRequest;n.addEventListener("load",function(){d(t,n)}),n.open("DELETE",this.url+"/"+e),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),s(t,n),n.send()},a.create=function(e,t){var n=new XMLHttpRequest;n.addEventListener("load",function(){d(t,n)}),n.open("POST",this.url),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),s(t,n),n.send(JSON.stringify(e))},a.save=function(e,t){var n=new XMLHttpRequest;n.addEventListener("load",function(){d(t,n)}),n.open("PUT",this.url),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),s(t,n),n.send(JSON.stringify(e))},a},this.object=function(i){var a=this,e=[],s={};if(i){for(var n in s.size=function(){var e,t=0,n=Object.getOwnPropertyNames(s);for(e in n)"length"!==n[e]&&"size"!==n[e]&&t++;return t},i)i[n]instanceof Function||"http"===n&&n.get&&n.put&&n.delete&&n.post||(e[n]=i[n],delete i[n],Object.defineProperty(i,n,{get:function(e,t){return function(){return e[t]}}(e,n),set:function(n,r){return function(o){Array.isArray(r),Array.isArray(this),Array.isArray(o)?(o.push=function(e){if(Array.prototype.push.call(o,e),s[r])for(var t in s[r])s[r][t](i,null,o)},o.pop=function(e){if(Array.prototype.pop.call(o),s[r])for(var t in s[r])s[r][t](i,null,o)},o.unshift=function(e){if(Array.prototype.unshift.call(o,e),s[r])for(var t in s[r])s[r][t](i,null,o)},o.shift=function(e){if(Array.prototype.shift.call(o),s[r])for(var t in s[r])s[r][t](i,null,o)},o.replace=function(e,t){if(Array.prototype.splice.call(o,e,1,t),s[r])for(var n in s[r])s[r][n](i,null,o)}):"object"!=typeof o||Array.isArray(this)||a.object(o);var e=n[r];if(n[r]=o,s[r])for(var t in s[r])s[r][t](i,e,o);Array.isArray(this)}}(e,n),enumerable:!0,configurable:!0}),Array.isArray(i[n])?(this.object(i[n]),i[n].push=function(e){if(Array.prototype.push.call(i[n],e),s[n])for(var t in a.object(e),s[n])s[n][t](i,null,e)}):"object"==typeof i[n]&&this.object(i[n]));for(var t in i.addChangeListener,i.addChangeListener=function(e,t){s[e]||(s[e]=[]),s[e].push(t)},i.getChangeListeners=function(){return s},i.clearChangeListeners=function(){s={size:function(){var e,t=0,n=Object.getOwnPropertyNames(s);for(e in n)"length"!==n[e]&&"size"!==n[e]&&t++;return t}}},i.fireChangeListeners=function(){var e,t=Object.getOwnPropertyNames(s);for(e in t)if("length"!==t[e]&&"size"!==t[e]&&s[t[e]].length)for(var n=0;n<s[t[e]].length;n++)"function"==typeof s[t[e]][n]&&s[t[e]][n](i,i[t[e]],i[t[e]])},i)"object"!=typeof i[t]||Array.isArray(i[t])||i.addChangeListener(t,function(e,t,n){if(t&&t!==n&&t.getChangeListeners){n.addChangeListener||a.object(n);var o,r=t.getChangeListeners();for(o in r)if("size"!==o&&r[o].length)for(var i=0;i<r[o].length;i++)n.addChangeListener(o,r[o][i])}})}},function(e){this.controller=void 0,this.init(e)}),Router=(View.prototype.init=function(e){if(this.elementName=e,this.element=document.querySelector(this.elementName),void 0===this.element)throw new Error("Element not found for selector: "+e);var o=this;me.templates.onDone=function(e,t){var n=t&&t.controller&&t.controller.model?t.controller.model:void 0,t=(n&&"object"==typeof n&&me.object(n),t&&t.controller?t.controller:void 0);o.onLoad(e,n,t)}},View.prototype.show=function(e,t){(this.controller=t)&&t.model&&"object"==typeof t.model&&me.object(t.model),me.templates.load(t?{url:e,controller:t}:e)},View.prototype.onLoad=function(e,t,n){if((e=void 0!==t?this.render(e,t,n):e)instanceof NodeList){this.getEl().innerHTML="";for(var o=0;o<e.length;o++)this.getEl().appendChild(e.item(o))}else this.getEl().innerHTML=e,this.process(this.getEl(),t,n);n&&"function"==typeof n.init&&n.init(this.getEl())},View.prototype.onError=function(e){},View.prototype.process=function(element,model,controller){var view=this,attr,doProcess=function(node){if(1===node.nodeType){for(var parent=node.parentNode,m=0;m<node.attributes.length;m++)attr=node.attributes.item(m),-1<attr.value.indexOf(expPrefix)&&(attr.value=view.replace(attr.value,model));for(var j=0,dis,propNames,fqPropName,propValue,name,propOwner;j<node.attributes.length;j++)if(attr=node.attributes.item(j),attr.name===attrPrefix+"repeat"){if(model[attr.value]){var data=model[attr.value],newNodes=[];if(0<data.length){for(var k=0;k<data.length;k++){var d=data[k],n=node.cloneNode(!0);n.attributes.removeNamedItem(attrPrefix+"repeat"),view.process(n,d),newNodes.push(n)}for(var l=0;l<newNodes.length;l++)node.parentNode.insertBefore(newNodes[l],node)}model.addChangeListener&&model.addChangeListener(attr.value,function(e,t,n){if(parent.innerHTML="",0<n.length)for(var o=0;o<n.length;o++){var r=n[o],i=node.cloneNode(!0);i.attributes.removeNamedItem(attrPrefix+"repeat"),view.process(i,r),parent.appendChild(i)}})}node.parentNode.removeChild(node)}else if(attr.name===attrPrefix+"click")node.onclick=view.createHandler(node,"click",attr.value);else if(attr.name===attrPrefix+"dblclick")node.ondblclick=view.createHandler(node,"dblclick",attr.value);else if(attr.name===attrPrefix+"enabled"){if(model[attr.value])throw"Not supported: Binding 'enabled' to model property.";"function"==typeof attr.value?dis=!attr.value():"string"==typeof attr.value?0===attr.value.indexOf("model")&&(propNames=attr.value.split("."),model.addChangeListener(propNames[1],function(e,t,n){node.disabled=void 0===model[propNames[1]]}),dis=void 0===model[propNames[1]]):dis=!eval(attr.value),node.disabled=dis}else attr.name===attrPrefix+"bind"?(fqPropName=attr.value,propValue=new Function("console.log("+fqPropName+"); return "+fqPropName).call(view),"checkbox"===node.type?node.checked=propValue:node.value=propValue,0<fqPropName.lastIndexOf(".")&&(name=fqPropName.substr(0,fqPropName.lastIndexOf(".")),propOwner=new Function("return "+name).call(view),node.onchange=function(e){"checkbox"===node.type?propOwner[fqPropName.substr(fqPropName.lastIndexOf(".")+1)]=!0===node.checked:propOwner[fqPropName.substr(fqPropName.lastIndexOf(".")+1)]=node.value}),view.createListener(fqPropName,node)):attr.name===attrPrefix+"model"&&(node.textContent=new Function("return "+attr.value).call(view),view.createTextBinding(attr.value,node))}var t,e;3===node.nodeType&&-1<node.nodeValue.indexOf(expPrefix)&&(t=view.replace(node.nodeValue,model),-1<t.indexOf("<p>")||-1<t.indexOf("<i>")||-1<t.indexOf("<strong>")||-1<t.indexOf("<br>")||-1<t.indexOf("<div>")||-1<t.indexOf("<h1>")||-1<t.indexOf("<h2>")||-1<t.indexOf("<h3>")||-1<t.indexOf("<h4>")||-1<t.indexOf("<h5>")||-1<t.indexOf("<h6>")?(e=document.createElement("span"),e.innerHTML=t,node.replaceWith(e)):node.nodeValue=t);for(var i=0;i<node.childNodes.length;i++)doProcess(node.childNodes.item(i))};if(element instanceof NodeList)for(var i=0;i<element.length;i++)doProcess(element.item(i));else{if(!(element instanceof Node))throw new Error("Element must be a DOM Node or NodeList instance.");doProcess(element)}},View.prototype.createHandler=function(node,event,code){var me=this,regex=new RegExp("[(].*[)]");return code.toLowerCase().startsWith("this.controller.")&&!regex.test(code)?function(e){e.preventDefault(),e.stopPropagation();var f=eval(code);f.call(me.controller,e)}:function(e){"click"!==event&&"dblclick"!==event||(e.preventDefault(),e.stopPropagation()),new Function(code).call(me)}},View.prototype.createListener=function(e,o){var r,t;0<e.lastIndexOf(".")&&(t=e.substr(0,e.lastIndexOf(".")),r=e.substr(e.lastIndexOf(".")+1),(e=new Function("return "+t).call(this))&&e.addChangeListener&&e.addChangeListener instanceof Function&&e.addChangeListener(r,function(e,t,n){"checkbox"===o.type?o.checked=n:o.value=n}),0<t.lastIndexOf("."))&&"this.controller"!==t&&"this.controller.model"!==t&&(e=t.substr(0,t.lastIndexOf(".")),e=new Function("return "+e).call(this))&&e.addChangeListener&&e.addChangeListener instanceof Function&&(t=t.substr(t.lastIndexOf(".")+1),e.addChangeListener(t,function(e,t,n){n?"checkbox"===o.type?o.checked=n[r]:o.value=n[r]:o.value=null,o.onchange=function(){"checkbox"===o.type?n[r]=o.checked:n[r]=o.value}}))},View.prototype.createTextBinding=function(e,o){var r,t;0<e.lastIndexOf(".")&&(t=e.substr(0,e.lastIndexOf(".")),r=e.substr(e.lastIndexOf(".")+1),(e=new Function("return "+t).call(this))&&e.addChangeListener&&e.addChangeListener instanceof Function&&e.addChangeListener(r,function(e,t,n){o.textContent=n}),0<t.lastIndexOf("."))&&"this.controller"!==t&&"this.controller.model"!==t&&(e=t.substr(0,t.lastIndexOf(".")),e=new Function("return "+e).call(this))&&e.addChangeListener&&e.addChangeListener instanceof Function&&(t=t.substr(t.lastIndexOf(".")+1),e.addChangeListener(t,function(e,t,n){o.textContent=n?n[r]:""}))},View.prototype.filter=function(e,t){return"Date"!==e?this.controller.hasOwnProperty(e)&&this.controller[e]instanceof Function?this.controller[e](t):t:!t||t.trim&&""===t.trim()?"":((e=new Date).setTime(t),e.toLocaleDateString("de-DE"))},View.prototype.render=function(e,t,n){var o;return t?-1<e.indexOf(attrPrefix)?(-1<e.indexOf(expPrefix)&&(e=this.replace(e,t)),(o=document.createElement("DIV")).innerHTML=e,this.process(o,t,n),o.childNodes):-1===e.indexOf(attrPrefix)?-1<e.indexOf(expPrefix)?this.replace(e,t,!1):e:void 0:this.replace(e,{})},View.prototype.replace=function(e,t,n){if(""===e.trim())return e;var o=e,r=e.match(/(\{{.+?\}})/g);if(r&&0<r.length)for(var i=0;i<r.length;i++){var a=r[i],s=a.substr(2,a.length-4),d=void 0,c=(-1<s.indexOf("|")&&(s=s.substr(0,s.indexOf("|")),d=a.substr(a.indexOf("|")+1,a.length-3-a.indexOf("|"))),"");t.hasOwnProperty(s)?(c=t[s]||"",d&&(c=this.filter(d,c)),o=o.replace(a,!0===n?'<span ae-model="'+s+'">'+c+"</span>":c)):-1<s.indexOf(".")&&(c=new Function("try { return this."+s+'; } catch (ex) { return "{{'+s+'}}";} ').call(t),o=o.replace(a,c))}return o},View.prototype.getEl=function(){if(this.element=document.querySelector(this.elementName),void 0===this.element)throw new Error("Element not found for selector: "+name);return this.element},this.view=function(e){return views[e]||(views[e]=new View(e)),views[e]},function(e){var t=this;this.root=e.root||null,this.useHash=e.useHash||!1,this.routes={},this.defaultHandler=void 0,window.addEventListener("DOMContentLoaded",function(){t.init()})});Router.prototype.default=function(e){if(!(e instanceof Function))throw new Error("The default route handler must be a function.");this.defaultHandler=e},Router.prototype.init=function(){var t=this;window.onhashchange=function(e){t.onhashchange.apply(t,[e])},window.onload=function(e){t.onhashchange.apply(t,[e])}},Router.prototype.on=function(e,t){if(!(t instanceof Function))throw new Error("Handler needs to be a function.");this.routes[e]=t},Router.prototype.onError=function(e){if(!(e instanceof Function))throw new Error("The default error handler must be a function.");this.errorHandler=e},Router.prototype.onhashchange=function(e){var t=window.location.href,n="";"load"===e.type?0<t.indexOf("#")&&(n=t.substr(t.indexOf("#")+1)):0<e.newURL.indexOf("#")&&(n=e.newURL.substr(e.newURL.indexOf("#")+1)),this.navigate(n)},Router.prototype.navigate=function(e){var t,n=this.routes[e=""===e?"/":e];if(this.params=t,void 0===n)for(var o in this.routes)if(0<o.indexOf(":")){var r=o.split("/"),i=e.split("/");try{if(i.length===r.length){t={},this.params=t;for(var a=0;a<r.length;a++)if(":"===r[a].charAt(0))t[r[a].substr(1)]=i[a];else if(i[a]!==r[a])throw t=void 0,new Error("not matching!");n=this.routes[o];break}}catch(e){continue}}if(void 0===(n=void 0===n?this.defaultHandler:n)){if(this.errorHandler)return void this.errorHandler({url:e});throw new Error("No handler for route: "+e)}if(!(n instanceof Function))throw new Error("Handler is not a function.");n(t?{params:t}:void 0)},this.router=function(e,t){return new Router({root:e,useHash:t})}});
//# sourceMappingURL=ae-ultraslim.map